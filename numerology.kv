#-*-coding:utf8;-*-
#:	import Factory kivy.factory.Factory
#:import random random.random
#:import rint random.randint

<GridButton@Button>:
    # transparent buttons
    background_normal: '' 
    background_color: 1, 1, 1, 0
    
    on_press: root.controller.gridButtonPress(self)
    on_release: root.controller.gridButtonRelease(self)

<CardButton@GridButton>:
    #font_size: '16dp'
    color: 1, 1, 0, 0.5
    bold: True 
    
    
<Controller>:
    orientation: 'vertical'
    
    #define needed conlrols' ids
    t_name: t_name
    t_date: t_date
    popup: popup
    
    Popup:
        id: popup
        title: "Значение"
        isOpen: False
        
        on_open: self.isOpen = True 
        on_dismiss: self.isOpen = False
        
        # this makes the popup float and hidden
        on_parent:
            if self.parent == root: self.parent.remove_widget(self)
        
        BoxLayout:
            #<ScrollableLabel>: 
            orientation: 'vertical'
            ScrollView:
                Label: 
                    size_hint_y: None 
                    height: self.texture_size[1] 
                    text_size: self.width, None 
                    text: root.popupText
            
            Button:
                # transparent buttons
                background_normal: '' 
                background_color: 1, 1, 1, 0
    
                size_hint_y: None
                size_y: '50dp'
                text: 'Затвори'
                on_release: popup.dismiss()
            
    ScreenManager:
        id: sm

        Screen:
            name: 'dataInputScreen'
            canvas:
                Color:
                    hsv: random(), .5, .3
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            BoxLayout:
                orientation: 'vertical'
                columns: 1
                padding: '5dp'
                #spacing: 5
                
                
                Label:
                    #size_hint_y: None
                    #height: '50dp'
                    text: 'Нова карта'
                    font_size: '64dp'
                    bold: True
                    
                Label:
                    halign: 'left'
                    text: 'Име:'
                
                TextInput:
                    # transparent buttons
                    background_normal: '' 
                    background_color: 1, 1, 1, 0
                    foreground_color: 1, 1, 1, 0.9
                    cursor_color: 1, 1, 1, 0.8
                
                    size_hint_y: 0.8
                    multiline: False
                    text: 'Test' if root.debug else str('')
                    id: t_name
                
                
                Label:
                    #size_hint_y: 0.5
                    text: 'Дата:'
                
                TextInput:
                    # transparent buttons
                    background_normal: '' 
                    background_color: 1, 1, 1, 0
                    foreground_color: 1, 1, 1, 0.9
                    cursor_color: 1, 1, 1, 0.7
                
                    size_hint_y: 0.8           
                    multiline: False
                    text: "%02d%02d%s" % (rint(1, 28), rint(1, 12), rint(1950, 2020)) if root.debug else str('') 
                    id: t_date

    
                BoxLayout:
                    orientation: 'horizontal' 
                    
                    CheckBox:
                        group: 'g_gender'
                        on_release: root.g_type = 'male'
                        active: True if root.g_type == 'male' else False
                    Label:
                        text: 'Мъж'

                    CheckBox:
                        group: 'g_gender' 
                        on_release: root.g_type = 'female'
                        active: True if root.g_type == 'female' else False
                    Label:
                        text: 'Жена'
                        
                    CheckBox:
                        group: 'g_gender'
                        on_release: root.g_type = 'event'
                        active: True if root.g_type == 'event' else False
                    Label:
                        text: 'Случай'
                
                
                AnchorLayout:
                    anchor_x: 'center'
                    anchor_y: 'center'
                    size_hint_y: 5
                    
            
                Button:
                    # transparent buttons
                    background_normal: '' 
                    background_color: 1, 1, 1, 0
                
                    size_hint_y: None
                    size_y: '58dp'
                    text: 'Към картата'
                    on_press:
                        root.processInput()
                        sm.transition.direction = 'left'
                        
                    on_release: 
                        sm.current = 'cardScreen'
                        
                            

        
        
        
        
        Screen:
            name: 'cardScreen'
            
            BoxLayout:
                orientation: 'vertical'
                padding: '5dp'
                
                GridButton:
                    text: t_name.text
                    size_hint: 1, 1/12.0
                    font_size: '42dp' 
                    bold: True 
                    name: 'full_meaning'
                
                BoxLayout:
                    orientation: 'horizontal'              
                    size_hint: 1, 1/9.0
                    
                    
                    GridButton:
                        text:'21'
                        name: 'date_number' 
                        id: date_number
                        size_hint: 0.1, 1
                    Label:
                        text: '21111985 = 28 = 10\n                       -2\n                      26 = 8'
                        id: cardStr_label
                        size_hint: 0.8, 1
                    GridButton:
                        text: '10' 
                        name: 'personal_number' 
                        id: personal_number
                        size_hint: 0.1, 1
                
                GridLayout:
                    rows: 5
                    cols: 5
                    spacing: 10
                    padding: 35
                    
                    # start row 1
                        
                    GridButton:
                        text: ''
                        name: 'GB1'
                        id: GB1
                        
                    GridButton:
                        #text: '|\nV'
                        name: 'self_col'
                        id: self_col
                        
                    GridButton:
                        #text: '|\nV'
                        name: 'others_col'
                        id: others_col
                        
                    GridButton:
                        #text: '|\nV'
                        name: 'higherself_col'
                        id: higherself_col
                        
                    GridButton:
                        text: ""
                        name: 'emotional_diag'
                        id: emotional_diag
                    
                    #
                    # row 2 start
                    # 
                        
                    GridButton:
                        text: ''
                        name: 'GB6'
                        id: GB6
                        
                    CardButton:
                        text: '?11'
                        name: '1'
                        id: 1
                        
                    CardButton:
                        text: '?4'
                        name: '4'
                        id: 4
                        
                    CardButton:
                        text: '?7'
                        name: '7'
                        id: 7
                        
                    GridButton:
                        text: ''
                        name: 'GB10'
                        id: GB10
                        
                    #
                    # start row 3
                    # 
                    
                    GridButton:
                        text: ''
                        name: 'nzero'
                        id: nzero
                        
                    CardButton:
                        text: '?22'
                        name: '2'
                        id: 2
                        
                    CardButton:
                        text: '?5'
                        name: '5'
                        id: 5
                        
                    CardButton:
                        text: '?8'
                        name: '8'
                        id: 8
                        
                    GridButton:
                        #text: '<--'
                        name: 'GB15'
                        id: GB15
                        
                    #
                    # start row 4
                    # 
                    
                    GridButton:
                        text: ''
                        name: 'GB16'
                        id: GB16
                        
                    CardButton:
                        text: '?3'
                        name: '3'
                        id: 3
                        
                    CardButton:
                        text: '?6'
                        name: '6'
                        id: 6
                        
                    CardButton:
                        text: '?99'
                        name: '9'
                        id: 9
                        
                    GridButton:
                        text: ''
                        name: 'GB20'
                        id: GB20
                        
                    #
                    # start row 5
                    # 
                    
                    GridButton:
                        text: ''
                        name: 'GB21'
                        id: GB21
                        
                    GridButton:
                        text: ''
                        name: 'none'
                        id: none
                        
                    GridButton:
                        text: '?0'
                        name: '0'
                        id: 0
                        
                    GridButton:
                        text: ''
                        name: 'nseven'
                        id: nseven
                        
                    GridButton:
                        text: ''
                        name: 'GB25'
                        id: GB25
                    
                    
                Button:
                    # transparent buttons
                    background_normal: '' 
                    background_color: 1, 1, 1, 0
    
                    size_hint_y: None
                    #size_hint: 1, 1/9.0
                    size_y: '48dp'
                    text: 'Нова карта'
                    on_release: 
                        sm.transition.direction = 'right'
                        sm.current = 'dataInputScreen'
